-- Customer Analysis:
-- 1) How many unique customers have made purchases?
-- 2) Who are the top 5 customers based on their total spending?
-- 3) How many orders were placed by each customer?
-- 4) How many customers have made repeat purchases?



-- Connect to the Database
USE eCommerce.SQL.Project;


-- 1) 5 unique customers
SELECT DISTINCT(COUNT(Customer_ID)) AS Unique_Customers FROM Customers;
-- DISTINCT pulls unique records, while COUNT will total them up.


 -- 2) Sarah Davis, John Doe, Jane smith, David Wilson, and Mike Johnson, inn that order from most to least in spending.
SELECT CONCAT(c.First_Name, SPACE(1), c.Last_Name) AS Name, SUM(Price) AS Order_Total_2
FROM Orders o
JOIN Order_Items i ON i.Order_ID = o.Order_ID
JOIN Customers c ON c.Customer_ID = o.Customer_ID
GROUP BY CONCAT(c.First_Name, SPACE(1), c.Last_Name)
ORDER BY SUM(Price) DESC;
-- CONCAT to combine the first and last name as one attribute.
-- JOIN Order_Items i for Price data.
-- JOIN Customers c for customers first and last name.
-- GROUP BY to essentially group each customers data for the total.
-- ORDER BY to display the customer with the most to least in total spending.


 -- 3) Displays the number of orders placed by each customer (12, 10, 10, 9, 9).
SELECT CONCAT(c.First_Name, SPACE(1), c.Last_Name) AS Name, COUNT(i.Order_ID) AS Order_Per_Cus
FROM Orders o
JOIN Order_Items i ON i.Order_ID = o.Order_ID
JOIN Customers c ON c.Customer_ID = o.Customer_ID
GROUP BY CONCAT(c.First_Name, SPACE(1), c.Last_Name)
ORDER BY Order_Per_Cus DESC;
-- COUNT(i.Order_ID) to GROUP the number of orders per customer.


-- All Customers have made repeat purchases or repurchased an item they once purchased.
SELECT  c.Customer_ID, COUNT(i.Product_ID) AS Repeat_Products
FROM Orders o
JOIN Order_Items i ON i.Order_ID = o.Order_ID
JOIN Customers c ON c.Customer_ID = o.Customer_ID
GROUP BY c.Customer_ID
-- COUNT(i.Products) to GROUP the number of Products purchased with each customer.
-- Anything above 1 would indicate that they made a repeat purchase.
